<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª â€” elbob4</title>
<style>
  :root{
    --bg:#f6f8fb;
    --card:#fff;
    --primary:#0d6efd;
    --muted:#6c757d;
    --accent:#1976d2;
  }
  *{box-sizing:border-box}
  body{font-family:Tahoma,Arial,Helvetica,sans-serif;margin:0;padding:0;direction:rtl;background:var(--bg)}
  .wrap{max-width:980px;margin:0 auto;padding:12px}
  header{background:#0b2545;color:#fff;padding:12px;border-radius:8px;text-align:center;font-size:18px;position:relative}
  header img{position:absolute;right:12px;top:6px;height:44px}
  .card{background:var(--card);padding:14px;border-radius:10px;margin-top:12px;box-shadow:0 6px 20px rgba(11,37,69,0.06)}
  .hidden{display:none}
  input,select,button,textarea{font-size:15px;padding:9px;border-radius:8px;border:1px solid #ddd;box-sizing:border-box}
  button{background:var(--primary);color:#fff;border:0;cursor:pointer}
  button.secondary{background:var(--muted)}
  .topbar{display:flex;justify-content:space-between;gap:8px;align-items:center}
  .menuBtn{background:var(--accent);color:#fff;padding:8px 14px;border-radius:6px;border:none;cursor:pointer;font-size:14px}
  .menuBtn:active{transform:translateY(1px)}
  .dropdown{position:relative;display:inline-block}
  .dropdown-menu{position:absolute;right:0;top:42px;background:#fff;border-radius:8px;box-shadow:0 8px 30px rgba(0,0,0,0.08);z-index:50;display:none;min-width:220px}
  .dropdown.open .dropdown-menu{display:block}
  .menu-item{display:flex;gap:8px;align-items:center;padding:10px 12px;border:0;background:none;width:100%;text-align:right;cursor:pointer}
  .menu-item:hover{background:#f2f6ff}
  .icon-sm{font-size:18px;width:28px;text-align:center}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .cars-list{max-height:220px;overflow:auto;border:1px dashed #eee;padding:6px;border-radius:8px;margin-top:8px;background:#fff}
  .cars-list .row{display:flex;justify-content:space-between;align-items:center;padding:6px;border-bottom:1px solid #f5f5f5}
  .result-box{background:#e9f7ef;border:1px solid #c7eed5;padding:10px;border-radius:8px;margin-top:8px}
  footer{margin-top:14px;text-align:center;color:var(--muted);font-size:13px;padding-bottom:30px}

  /* login screen look */
  #loginScreen{max-width:420px;margin:40px auto;background:#f2f2f2}
  #loginScreen img{display:block;margin:6px auto 12px;max-width:140px}
  #loginScreen h3{margin:0 0 6px 0}

  /* main app background (bus) */
  #mainApp{min-height:100vh;padding:18px;background-position:center;background-repeat:no-repeat;background-size:cover}
  /* keep cards slightly opaque so text readable over bg */
  #mainApp .card{background:rgba(255,255,255,0.95)}

  @media(max-width:769px)@ box{
  ;background:#2196f3
      ;font-size:18px
    
   
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- login screen -->
  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginScreen" class="card">
  <div style="text-align:center;margin-bottom:12px">
    <img src="suez-logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù‡ÙŠØ¦Ø©" style="width:90px;height:auto;margin-bottom:8px">
    <h3 style="margin:6px 0">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
  </div>

  <div class="form-group">
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
    <input id="usernameInput" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
  </div>

  <div class="form-group" style="position:relative">
    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <input id="passwordInput" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="padding-right:35px">
    <span onclick="togglePassword()" 
          style="position:absolute;top:34px;right:10px;cursor:pointer;font-size:18px;color:#555">ğŸ‘ï¸</span>
  </div>

  <div style="display:flex;gap:8px;margin-top:10px">
    <button onclick="attemptLogin()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <div id="loginMsg" style="color:#b02a37;margin-top:8px;display:none"></div>
</div>

<style>
  #loginScreen .form-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-bottom: 12px;
  }
  #loginScreen input {
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 15px;
  }
</style>

<script>
function togglePassword(){
  const pass = document.getElementById("passwordInput");
  pass.type = pass.type === "password" ? "text" : "password";
}
</script>
  <!-- main app -->
  <div id="mainApp" class="hidden">

    <header>ğŸš˜ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª - Ù‡ÙŠØ¦Ø© Ù‚Ù†Ø§Ø© Ø§Ù„Ø³ÙˆÙŠØ³
      <img src="suez-logo.png" alt="Ø´Ø¹Ø§Ø±">
    </header>

    <!-- topbar with dropdown -->
    <div class="card topbar">
      <div style="display:flex;gap:8px;align-items:center">
        <button class="menuBtn" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
        <div style="color:var(--muted)">Ù…Ø³ØªØ®Ø¯Ù…: <b id="currentUser"></b></div>
      </div>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© -->
<div style="display:flex;gap:8px;align-items:center">
  <div class="dropdown" id="mainDropdown">
    <button class="menuBtn" onclick="toggleDropdown()">â˜° Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    <div class="dropdown-menu" role="menu">
        
      <button class="menu-item" data-target="addCarScreen">
        <span class="icon-sm">â•</span>
        <span>Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø©</span>
      </button>

      <button class="menu-item" data-target="deleteCarScreen">
        <span class="icon-sm">ğŸ—‘ï¸</span>
        <span>Ø­Ø°Ù / ØªØ¹Ø¯ÙŠÙ„</span>
      </button>

      <button class="menu-item" data-target="passwordScreen">
        <span class="icon-sm">ğŸ”‘</span>
        <span>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</span>
      </button>

      <button class="menu-item" data-target="usernameScreen">
        <span class="icon-sm">ğŸ‘¤</span>
        <span>ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span>
      </button>

      <button class="menu-item" data-target="recordSearchScreen">
        <span class="icon-sm">ğŸ“–</span>
        <span>Ø¨Ø­Ø« Ø¨Ø§Ù„Ø³Ø¬Ù„</span>
      </button>

      <button class="menu-item" data-target="importScreen">
        <span class="icon-sm">â¬‡ï¸</span>
        <span>Ø§Ø³ØªÙŠØ±Ø§Ø¯ (CSV)</span>
      </button>

      <button class="menu-item" onclick="exportAll()">
        <span class="icon-sm">â¬†ï¸</span>
        <span>ØªØµØ¯ÙŠØ± (ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª)</span>
      </button>

    </div>
  </div>
</div>

<!-- Ø§Ù„Ø§Ø³ØªØ§ÙŠÙ„ -->
<style>
.menuBtn {
  background: #1976d2;
  color: #fff;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
}
.menuBtn:hover {
  background: #1565c0;
}
.dropdown {
  position: relative;
}
.dropdown-menu {
  display: none;
  position: absolute;
  right: 0;
  top: 100%;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  min-width: 220px;
  z-index: 100;
}
.dropdown.open .dropdown-menu {
  display: block;
}
.menu-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border: none;
  background: none;
  width: 100%;
  text-align: right;
  cursor: pointer;
  font-size: 15px;
  color: #222;
}
.menu-item:hover {
  background: #f2f6ff;
}
.icon-sm {
  font-size: 18px;
  width: 24px;
  text-align: center;
  flex-shrink: 0;
  color: #1976d2;
}
</style>

<!-- Ø§Ù„Ø¬Ø§ÙØ§ -->
<script>
function toggleDropdown(){
  document.getElementById('mainDropdown').classList.toggle('open');
}
</script>
    <!-- SEARCH SCREEN -->
    <div id="searchScreen" class="card">
      <h3>ğŸ” Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø­Ø«</h3>

      <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
        <input id="searchNumber" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ø£Ùˆ Ø¬Ø²Ø¡ Ù…Ù†Ù‡)">
        <button onclick="searchCar()">Ø¨Ø­Ø«</button>
      <!-- Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø³Ø­ ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø­Ø« -->
<button class="secondary" onclick="clearSearch()">Ù…Ø³Ø­</button>

<script>
function clearSearch() {
  // ÙŠÙ…Ø³Ø­ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø«
  document.getElementById("searchNumber").value = "";

  // ÙŠØ±Ø¬Ø¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  document.getElementById("carInfo").innerHTML = "Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø³ÙŠØ§Ø±Ø© Ø¨Ø¹Ø¯";

  // ÙŠÙØ¶ÙŠ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„ØªÙˆØ§Ø±ÙŠØ®
  document.getElementById("lastOdometer").value = "";
  document.getElementById("lastDate").value = "";
  document.getElementById("currentOdometer").value = "";
  document.getElementById("currentDate").value = "";
  document.getElementById("fuelAmount").value = "";
  document.getElementById("distanceField").value = "";
  document.getElementById("percentageField").value = "";

  // ÙŠØ±Ø¬Ø¹ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù„Ù€ null
  selectedCar = null;
}
</script>
      </div>

      <div id="carInfo" class="card" style="margin-top:10px;padding:10px;background:#fbfbff;border:1px solid #f0f4ff">
        Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø³ÙŠØ§Ø±Ø© Ø¨Ø¹Ø¯
      </div>

      <div class="grid-2" style="margin-top:8px">
        <div>
          <label>Ø¢Ø®Ø± Ø¹Ø¯Ø§Ø¯</label>
          <input id="lastOdometer" type="text" readonly placeholder="â€”">
        </div>
        <div>
          <label>ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø¹Ø¯Ø§Ø¯</label>
          <input id="lastDate" type="text" readonly placeholder="â€”">
        </div>
      </div>

      <div class="grid-2" style="margin-top:8px">
        <div>
          <label>Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
          <input id="currentOdometer" type="number" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
        </div>
        <div>
          <label>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ø¯ÙŠØ¯ (ÙŠÙ…ÙƒÙ† Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®)</label>
          <input id="currentDate" type="date" placeholder="YYYY-MM-DD">
        </div>
      </div>

      <div style="margin-top:8px">
        <label>ÙƒÙ…ÙŠØ© Ø§Ù„ÙˆÙ‚ÙˆØ¯ (Ù„ØªØ±)</label>
        <input id="fuelAmount" type="number" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ…ÙŠØ© Ø§Ù„ÙˆÙ‚ÙˆØ¯">
      </div>

      <div class="grid-2" style="margin-top:10px">
        <div>
          <label>Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©</label>
          <input id="distanceField" type="text" readonly placeholder="">
        </div>
        <div>
          <label>Ø§Ù„Ù†Ø³Ø¨Ø© (ÙƒÙ…ÙŠØ© Ã· Ù…Ø³Ø§ÙØ© Ã— 100)</label>
          <input id="percentageField" type="text" readonly placeholder="">
        </div>
      </div>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button onclick="saveTrip()">Ø­ÙØ¸</button>
        <button class="secondary" onclick="exportCurrentIfExists()">ØªØµØ¯ÙŠØ± Ø³ÙŠØ§Ø±Ø©</button>
        <button class="secondary" onclick="exportAll()">ØªØµØ¯ÙŠØ± ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</button>
      </div>

      <div style="margin-top:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="color:var(--muted)">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</div>
          <div style="color:var(--muted);font-size:13px">Ø§Ø¶ØºØ· Ø§Ø®ØªÙŠØ§Ø± Ù„Ù…Ù„Ø¡ Ø§Ù„Ø¨Ø­Ø«</div>
        </div>
        <div id="carsList" class="cars-list"></div>
      </div>

    </div>

    <!-- ADD CAR SCREEN -->
  <!-- ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø© -->
<div id="addCarScreen" class="card hidden">
  <h3>â• Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø©</h3>

  <div class="form-group">
    <label>Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ù…ÙØªØ§Ø­)</label>
    <input id="add_number" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø³ ÙŠ 1234">
  </div>

  <div class="form-group">
    <label>Ø§Ù„Ø³Ø¬Ù„</label>
    <input id="add_record" type="text">
  </div>

  <div class="form-group">
    <label>Ø§Ù„ÙƒÙˆØ¯</label>
    <input id="add_code" type="text">
  </div>

  <div class="form-group">
    <label>Ø§Ù„Ù…Ø§Ø±ÙƒØ©</label>
    <input id="add_brand" type="text">
  </div>

  <div class="form-group">
    <label>Ø§Ù„Ù†ÙˆØ¹</label>
    <input id="add_model" type="text">
  </div>

  <div class="form-group">
    <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆÙ‚ÙˆØ¯</label>
    <select id="add_fuelType">
      <option value="">â€” Ø§Ø®ØªØ± â€”</option>
      <option>Ø¨Ù†Ø²ÙŠÙ†</option>
      <option>Ø³ÙˆÙ„Ø§Ø±</option>
      <option>ØºØ§Ø²</option>
    </select>
  </div>

  <div class="form-group">
    <label>Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
    <input id="add_odometer" type="number">
  </div>

  <div class="form-group">
    <label>ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø¹Ø¯Ø§Ø¯</label>
    <input id="add_odometer_date" type="text" placeholder="YYYY-MM-DD"
           onfocus="this.type='date'"
           onblur="if(!this.value)this.type='text'">
  </div>

  <div style="display:flex;gap:8px;margin-top:12px">
    <button onclick="addCar()">ğŸ’¾ Ø­ÙØ¸</button>
    <button class="secondary" onclick="clearAddCar()">ğŸ§¹ Ù…Ø³Ø­</button>
     <button class="secondary" onclick="showScreen('searchScreen')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
  </div>
</div>

<style>
  #addCarScreen .form-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-bottom: 12px;
  }
  #addCarScreen input,
  #addCarScreen select {
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 15px;
  }
</style>

<script>
function clearAddCar(){
  document.getElementById("add_number").value = "";
  document.getElementById("add_record").value = "";
  document.getElementById("add_code").value = "";
  document.getElementById("add_brand").value = "";
  document.getElementById("add_model").value = "";
  document.getElementById("add_fuelType").value = "";
  document.getElementById("add_odometer").value = "";
  document.getElementById("add_odometer_date").value = "";
}
</script>
    <!-- DELETE / EDIT SCREEN -->
    <div id="deleteCarScreen" class="card hidden">
      <h3>ğŸ—‘ï¸ Ø­Ø°Ù / ØªØ¹Ø¯ÙŠÙ„ Ø³ÙŠØ§Ø±Ø©</h3>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="deleteSearchNumber" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø£Ùˆ Ø¬Ø²Ø¡ Ù…Ù†Ù‡">
        <button onclick="searchCarToDelete()">Ø¨Ø­Ø«</button>
        <button class="secondary" onclick="clearDeleteSearch()">Ù…Ø³Ø­</button>
        <button class="secondary" onclick="showScreen('searchScreen')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
      </div>
      <div id="deleteCarResult" style="margin-top:10px;padding:10px;background:#fbfbff;border:1px solid #f0f4ff">
        Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø³ÙŠØ§Ø±Ø© Ø¨Ø¹Ø¯
      </div>
    </div>

    <!-- USERNAME SCREEN -->
    <div id="usernameScreen" class="card hidden">
      <h3>ğŸ‘¤ ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
      <input id="newUsername" type="text">
      <div style="display:flex;gap:8px;margin-top:10px">
        <button onclick="changeUsername()">Ø­ÙØ¸</button>
        <button class="secondary" onclick="showScreen('searchScreen')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
      </div>
      <div id="userMsg" style="margin-top:8px;color:var(--muted)"></div>
    </div>

    <!-- PASSWORD SCREEN -->
    <div id="passwordScreen" class="card hidden">
      <h3>ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</label>
      <input id="oldPass" type="password">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
      <input id="newPass1" type="password">
      <label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
      <input id="newPass2" type="password">
      <div style="display:flex;gap:8px;margin-top:10px">
        <button onclick="changePassword()">Ø­ÙØ¸</button>
        <button class="secondary" onclick="showScreen('searchScreen')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
      </div>
      <div id="passMsg" style="margin-top:8px;color:var(--muted)"></div>
    </div>

    <!-- RECORD SEARCH SCREEN -->
    <div id="recordSearchScreen" class="card hidden">
      <h3>ğŸ“– Ø¨Ø­Ø« Ø¨Ø§Ù„Ø³Ø¬Ù„</h3>
      <label>Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„</label>
      <input id="recordSearch" type="text">
      <div style="display:flex;gap:8px;margin-top:8px">
        <button onclick="searchByRecord()">Ø¨Ø­Ø«</button>
        <button class="secondary" onclick="showScreen('searchScreen')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
      </div>
      <div id="recordResult" style="margin-top:10px"></div>
    </div>

    <!-- IMPORT SCREEN -->
    <div id="importScreen" class="card hidden">
      <h3>â¬‡ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† CSV</h3>
      <div style="color:var(--muted);font-size:13px">Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: Ø±Ù‚Ù…,Ø§Ù„Ø³Ø¬Ù„,Ø§Ù„ÙƒÙˆØ¯,Ù…Ø§Ø±ÙƒØ©,Ù†ÙˆØ¹,Ù†ÙˆØ¹ ÙˆÙ‚ÙˆØ¯,Ø¢Ø®Ø± Ø¹Ø¯Ø§Ø¯,ØªØ§Ø±ÙŠØ®</div>
      <input id="csvFileInput" type="file" accept=".csv" style="margin-top:8px"/>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button onclick="importFromFile()">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
        <button class="secondary" onclick="showScreen('searchScreen')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
      </div>
      <div id="importMsg" style="margin-top:8px;color:var(--muted)"></div>
    </div>

  </div> <!-- end mainApp -->

  <footer>Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ© â€” ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­ (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ± CSV)</footer>
</div>

<script>
/* ---------------- Storage keys & defaults ---------------- */
const STORAGE_USER = 'app_user';
const STORAGE_PASS = 'app_pass';
const STORAGE_CARS = 'app_cars_backup';

if(!localStorage.getItem(STORAGE_USER)) localStorage.setItem(STORAGE_USER, 'ayman');
if(!localStorage.getItem(STORAGE_PASS)) localStorage.setItem(STORAGE_PASS, '4989');

/* in-memory list */
let cars = [];
let selectedCar = null;
let editingNumber = null; // when editing via add screen

/* ---------------- Backup helpers ---------------- */
function saveBackup(){ localStorage.setItem(STORAGE_CARS, JSON.stringify(cars)); }
function loadBackup(){ const v = localStorage.getItem(STORAGE_CARS); if(v){ try{ cars = JSON.parse(v); }catch(e){ cars = []; } } }

/* ---------------- UI helpers ---------------- */
function showScreen(id){
  const ids = ['searchScreen','addCarScreen','deleteCarScreen','passwordScreen','usernameScreen','recordSearchScreen','importScreen'];
  ids.forEach(sid => { const el=document.getElementById(sid); if(el) el.classList.add('hidden'); });
  if(id && document.getElementById(id)) document.getElementById(id).classList.remove('hidden');
  else document.getElementById('searchScreen').classList.remove('hidden');
}
function toggleDropdown(){ document.getElementById('mainDropdown').classList.toggle('open'); }
document.addEventListener('click', function(e){
  if(e.target.closest('.menu-item')){
    const btn = e.target.closest('.menu-item');
    const target = btn.getAttribute('data-target');
    if(target) showScreen(target);
    document.getElementById('mainDropdown').classList.remove('open');
  } else {
    if(!e.target.closest('#mainDropdown')) document.getElementById('mainDropdown').classList.remove('open');
  }
});

/* ---------------- Login / logout ---------------- */
function attemptLogin(){
  const u = document.getElementById('usernameInput').value.trim();
  const p = document.getElementById('passwordInput').value.trim();
  const savedU = localStorage.getItem(STORAGE_USER);
  const savedP = localStorage.getItem(STORAGE_PASS);
  const msg = document.getElementById('loginMsg');
  msg.style.display = 'none';
  if(u === savedU && p === savedP){
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('mainApp').classList.remove('hidden');
    // set background bus (requires bus-bg.jpg in same folder)
    document.getElementById('mainApp').style.backgroundImage = "url('bus-bg.jpg')";
    document.getElementById('currentUser').innerText = u;
    renderCarsList();
    showScreen('searchScreen');
  } else {
    msg.style.display = 'block';
    msg.innerText = 'âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
  }
}
function cancelLogin(){
  document.getElementById('usernameInput').value = '';
  document.getElementById('passwordInput').value = '';
  document.getElementById('loginMsg').style.display = 'none';
}
function logout(){
  document.getElementById('mainApp').classList.add('hidden');
  document.getElementById('loginScreen').classList.remove('hidden');
  // remove bus background to make login clearly different
  document.getElementById('mainApp').style.backgroundImage = '';
  selectedCar = null;
}

/* ---------------- Cars list rendering ---------------- */
function renderCarsList(){
  const container = document.getElementById('carsList');
  container.innerHTML = '';
  if(cars.length === 0){
    container.innerHTML = '<div style="padding:8px;color:#777;font-style:italic">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª Ù…Ø³Ø¬Ù„Ø©</div>';
    return;
  }
  cars.forEach(c => {
    const row = document.createElement('div');
    row.className = 'row';
    row.innerHTML = `<div><b>${c.number}</b><div style="font-size:12px;color:#666">${c.brand||''} ${c.model? '('+c.model+')':''}</div></div>`;
    const actions = document.createElement('div');
    const sel = document.createElement('button');
    sel.className = 'menuBtn';
    sel.style.padding = '6px';
    sel.style.fontSize = '13px';
    sel.innerText = 'Ø§Ø®ØªÙŠØ§Ø±';
    sel.onclick = () => { document.getElementById('searchNumber').value = c.number; searchCar(); };
    actions.appendChild(sel);
    row.appendChild(actions);
    container.appendChild(row);
  });
}

/* ---------------- Add / Edit car ---------------- */
function addCar(){
  const number = document.getElementById('add_number').value.trim();
  if(!number){ alert('âš ï¸ Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©'); return; }
  const car = {
    number,
    record: document.getElementById('add_record').value.trim(),
    code: document.getElementById('add_code').value.trim(),
    brand: document.getElementById('add_brand').value.trim(),
    model: document.getElementById('add_model').value.trim(),
    fuelType: document.getElementById('add_fuelType').value,
    lastOdometer: document.getElementById('add_odometer').value ? parseInt(document.getElementById('add_odometer').value) : '',
    lastDate: document.getElementById('add_odometer_date').value || ''
  };
  const idx = cars.findIndex(c => c.number === number);
  if(idx > -1){
    cars[idx] = car;
  } else {
    cars.push(car);
  }
  saveBackup();
  renderCarsList();
  alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©');
  clearAddForm();
  showScreen('searchScreen');
}
function clearAddForm(){
  ['add_number','add_record','add_code','add_brand','add_model','add_fuelType','add_odometer','add_odometer_date'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value='';});
}

/* ---------------- Search logic ---------------- */
function normalize(s){ return String(s||'').replace(/\s+/g,'').toLowerCase(); }
function onlyDigits(s){ return /^\d+$/.test(s); }

function searchCar(){
  const q = document.getElementById('searchNumber').value.trim();
  if(!q){ alert('Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø£Ùˆ Ø¬Ø²Ø¡ Ù…Ù†Ù‡ Ù„Ù„Ø¨Ø­Ø«'); return; }
  // decide digits-only search
  const isDigits = onlyDigits(q);
  let found = null;
  if(isDigits){
    const qd = q.replace(/\s+/g,'');
    found = cars.find(c => (String(c.number||'').replace(/\s+/g,'').includes(qd)));
  } else {
    const ql = q.toLowerCase();
    found = cars.find(c => (c.number||'').toLowerCase().includes(ql));
  }
  if(!found){ selectedCar = null; document.getElementById('carInfo').innerHTML = 'ğŸš« Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!'; document.getElementById('lastOdometer').value=''; document.getElementById('lastDate').value=''; return; }
  selectedCar = found;
  renderSelectedCar();
}
function renderSelectedCar(){
  if(!selectedCar) return;
  document.getElementById('carInfo').innerHTML = `<b>Ø±Ù‚Ù…:</b> ${selectedCar.number} <button style="margin-left:8px" onclick="showCarDetails()">â—</button>
    <div style="margin-top:6px"><b>Ù…Ø§Ø±ÙƒØ©:</b> ${selectedCar.brand||'-'} â€” <b>Ù†ÙˆØ¹:</b> ${selectedCar.model||'-'} â€” <b>ÙˆÙ‚ÙˆØ¯:</b> ${selectedCar.fuelType||'-'}</div>`;
  document.getElementById('lastOdometer').value = selectedCar.lastOdometer !== undefined ? selectedCar.lastOdometer : '';
  document.getElementById('lastDate').value = selectedCar.lastDate || '';
  // clear inputs
  document.getElementById('currentOdometer').value = '';
  document.getElementById('currentDate').value = '';
  document.getElementById('fuelAmount').value = '';
  document.getElementById('distanceField').value = '';
  document.getElementById('percentageField').value = '';
}

/* show details button */
function showCarDetails(){
  if(!selectedCar) return;
  alert(`ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:\n\nØ±Ù‚Ù…: ${selectedCar.number}\nØ§Ù„Ø³Ø¬Ù„: ${selectedCar.record||'-'}\nØ§Ù„ÙƒÙˆØ¯: ${selectedCar.code||'-'}\nØ§Ù„Ù…Ø§Ø±ÙƒØ©: ${selectedCar.brand||'-'}\nØ§Ù„Ù†ÙˆØ¹: ${selectedCar.model||'-'}\nÙ†ÙˆØ¹ Ø§Ù„ÙˆÙ‚ÙˆØ¯: ${selectedCar.fuelType||'-'}\nØ¢Ø®Ø± Ø¹Ø¯Ø§Ø¯: ${selectedCar.lastOdometer||'-'}\nØªØ§Ø±ÙŠØ®: ${selectedCar.lastDate||'-'}`);
}

/* ---------------- Auto compute distance & percentage ---------------- */
document.getElementById('currentOdometer').addEventListener('input', computeAuto);
document.getElementById('fuelAmount').addEventListener('input', computeAuto);

function computeAuto(){
  const curVal = document.getElementById('currentOdometer').value;
  const fuelVal = document.getElementById('fuelAmount').value;
  if(!selectedCar || !curVal) { document.getElementById('distanceField').value=''; document.getElementById('percentageField').value=''; return; }
  const cur = parseFloat(curVal);
  const last = selectedCar && selectedCar.lastOdometer ? parseFloat(selectedCar.lastOdometer) : NaN;
  if(isNaN(cur) || isNaN(last)) { document.getElementById('distanceField').value=''; document.getElementById('percentageField').value=''; return; }
  const distance = cur - last;
  if(isNaN(distance) || distance < 0){ document.getElementById('distanceField').value=''; document.getElementById('percentageField').value=''; return; }
  document.getElementById('distanceField').value = distance;
  const fuel = parseFloat(fuelVal);
  if(!isNaN(fuel) && fuel > 0 && distance > 0){
    const perc = Math.round((fuel / distance) * 100);
    document.getElementById('percentageField').value = perc;
  } else {
    document.getElementById('percentageField').value = '';
  }
}

/* ---------------- Save trip ---------------- */
function saveTrip(){
  if(!selectedCar){ alert('Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙŠØ§Ø±Ø© Ø£ÙˆÙ„Ø§'); return; }
  const idx = cars.findIndex(c => c.number === selectedCar.number);
  if(idx === -1){ alert('Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©'); return; }
  const cur = parseInt(document.getElementById('currentOdometer').value);
  const curDate = document.getElementById('currentDate').value;
  const fuel = document.getElementById('fuelAmount').value ? parseFloat(document.getElementById('fuelAmount').value) : '';
  if(isNaN(cur) || !curDate){ alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®'); return; }
  const last = cars[idx].lastOdometer ? parseInt(cars[idx].lastOdometer) : NaN;
  const distance = (!isNaN(last)) ? (cur - last) : NaN;
  if(!isNaN(distance) && distance < 0){ alert('Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø£ØµØºØ± Ù…Ù† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚'); return; }
  const percentage = (!isNaN(distance) && fuel !== '' && distance>0) ? Math.round((fuel / distance) * 100) : '';
  // update
  cars[idx].lastTrip = {distance: isNaN(distance)?'':distance, fuel, percentage, date: curDate};
  cars[idx].lastOdometer = cur;
  cars[idx].lastDate = curDate;
  saveBackup(); renderCarsList(); renderSelectedCar();
  document.getElementById('resultBox').classList.remove('hidden');
  document.getElementById('resultBox').innerHTML = `âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸<br>Ø§Ù„Ù…Ø³Ø§ÙØ©: <b>${!isNaN(distance)?distance:'-'}</b> ÙƒÙ…<br>Ø§Ù„Ù†Ø³Ø¨Ø©: <b>${percentage!==''?percentage+'%':'-'}</b>`;
}

/* ---------------- Export / Import ---------------- */
function buildCSV(arr){
  const header = ['Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©','Ø§Ù„Ø³Ø¬Ù„','Ø§Ù„ÙƒÙˆØ¯','Ø§Ù„Ù…Ø§Ø±ÙƒØ©','Ø§Ù„Ù†ÙˆØ¹','Ù†ÙˆØ¹ Ø§Ù„ÙˆÙ‚ÙˆØ¯','Ø¢Ø®Ø± Ø¹Ø¯Ø§Ø¯','ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø¹Ø¯Ø§Ø¯'];
  const lines = [header.join(',')];
  arr.forEach(c=>{
    const row = [
      csvEscape(c.number||''),
      csvEscape(c.record||''),
      csvEscape(c.code||''),
      csvEscape(c.brand||''),
      csvEscape(c.model||''),
      csvEscape(c.fuelType||''),
      csvEscape(c.lastOdometer!==undefined?String(c.lastOdometer):''),
      csvEscape(c.lastDate||'')
    ];
    lines.push(row.join(','));
  });
  return lines.join('\n');
}
function csvEscape(s){ if(s==null) return ''; s = String(s); if(s.includes(',')||s.includes('\n')||s.includes('"')) return `"${s.replace(/"/g,'""')}"`; return s; }

function downloadCSV(filename,content){
  const blob = new Blob([content], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = filename || 'cars.csv';
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}

function exportAll(){
  if(cars.length===0){ alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±'); return; }
  const csv = buildCSV(cars);
  downloadCSV('cars_all.csv', csv);
}
function exportCurrentIfExists(){
  if(!selectedCar){ alert('Ø§Ø®ØªØ± Ø³ÙŠØ§Ø±Ø© Ø£ÙˆÙ„Ø§Ù‹'); return; }
  const csv = buildCSV([selectedCar]);
  downloadCSV((selectedCar.number||'car') + '.csv', csv);
}

function importFromFile(){
  const input = document.getElementById('csvFileInput');
  if(!input.files || input.files.length===0){ alert('Ø§Ø®ØªØ± Ù…Ù„Ù CSV'); return; }
  const reader = new FileReader();
  reader.onload = function(e){
    try{
      const text = e.target.result.replace(/\r/g,'');
      const rows = text.split('\n').filter(r => r.trim()!=='');
      if(rows.length <= 1){ alert('Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª'); return; }
      let added=0, updated=0;
      for(let i=1;i<rows.length;i++){
        const cols = parseCSVRow(rows[i]);
        const number = cols[0]||'';
        if(!number) continue;
        const record = cols[1]||''; const code = cols[2]||''; const brand = cols[3]||''; const model = cols[4]||''; const fuelType = cols[5]||''; const lastOdometer = cols[6]?parseInt(cols[6]):''; const lastDate = cols[7]||'';
        const idx = cars.findIndex(c => c.number === number);
        const car = {number, record, code, brand, model, fuelType, lastOdometer, lastDate};
        if(idx === -1){ cars.push(car); added++; } else { cars[idx] = {...cars[idx], ...car}; updated++; }
      }
      saveBackup(); renderCarsList();
      alert(`âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ â€” Ø¥Ø¶Ø§ÙØ©: ${added}ØŒ ØªØ¹Ø¯ÙŠÙ„: ${updated}`);
      document.getElementById('csvFileInput').value = '';
      showScreen('searchScreen');
    }catch(err){
      alert('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ CSV.');
    }
  };
  reader.readAsText(input.files[0], 'utf-8');
}
// simple CSV row parser (handles quoted fields)
function parseCSVRow(line){
  const cols=[]; let cur=''; let inQuotes=false;
  for(let i=0;i<line.length;i++){
    const ch=line[i];
    if(ch === '"' ){
      if(inQuotes && line[i+1]==='"'){ cur+='"'; i++; continue; }
      inQuotes = !inQuotes; continue;
    }
    if(ch===',' && !inQuotes){ cols.push(cur); cur=''; continue; }
    cur += ch;
  }
  cols.push(cur);
  return cols.map(c=>c.trim());
}

/* ---------------- Delete / Edit from delete screen ---------------- */
function searchCarToDelete(){
  const q = document.getElementById('deleteSearchNumber').value.trim();
  const resultDiv = document.getElementById('deleteCarResult');
  if(!q){ alert('Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©'); return; }
  const qnorm = q.toLowerCase();
  const matches = cars.filter(c => (c.number||'').toLowerCase().includes(qnorm));
  if(matches.length === 0){ resultDiv.innerHTML = '<p style="color:red">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>'; return; }
  resultDiv.innerHTML = matches.map(c => `
    <div style="border-bottom:1px solid #eee;padding:8px 0">
      <p><b>Ø§Ù„Ø±Ù‚Ù…:</b> ${c.number}</p>
      <p><b>Ø§Ù„Ø³Ø¬Ù„:</b> ${c.record||'-'}</p>
      <p style="margin-top:6px">
        <button style="background:#dc3545;color:#fff;border:none;padding:6px;border-radius:6px;margin-right:8px" onclick="deleteCar('${c.number}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        <button style="background:#fd7e14;color:#fff;border:none;padding:6px;border-radius:6px" onclick="editCar('${c.number}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
      </p>
    </div>
  `).join('');
}
function clearDeleteSearch(){ document.getElementById('deleteSearchNumber').value=''; document.getElementById('deleteCarResult').innerHTML='Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø³ÙŠØ§Ø±Ø© Ø¨Ø¹Ø¯'; }
function deleteCar(number){
  if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø© ${number}ØŸ`)) return;
  cars = cars.filter(c => c.number !== number);
  saveBackup(); renderCarsList();
  alert('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù');
  document.getElementById('deleteCarResult').innerHTML = 'ØªÙ… Ø§Ù„Ø­Ø°Ù';
}

/* open add screen prefilled for editing */
function editCar(number){
  const car = cars.find(c => c.number === number);
  if(!car){ alert('Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©'); return; }
  document.getElementById('add_number').value = car.number;
  document.getElementById('add_record').value = car.record || '';
  document.getElementById('add_code').value = car.code || '';
  document.getElementById('add_brand').value = car.brand || '';
  document.getElementById('add_model').value = car.model || '';
  document.getElementById('add_fuelType').value = car.fuelType || '';
  document.getElementById('add_odometer').value = car.lastOdometer !== undefined ? car.lastOdometer : '';
  document.getElementById('add_odometer_date').value = car.lastDate || '';
  editingNumber = car.number;
  showScreen('addCarScreen');
}

/* ---------------- Change username / password ---------------- */
function changeUsername(){
  const nu = document.getElementById('newUsername').value.trim();
  if(!nu){ alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯'); return; }
  localStorage.setItem(STORAGE_USER, nu);
  document.getElementById('currentUser').innerText = nu;
  alert('âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
  showScreen('searchScreen');
}
function changePassword(){
  const oldP = document.getElementById('oldPass').value.trim();
  const new1 = document.getElementById('newPass1').value.trim();
  const new2 = document.getElementById('newPass2').value.trim();
  if(oldP !== localStorage.getItem(STORAGE_PASS)){ alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©'); return; }
  if(!new1 || !new2){ alert('Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø±ØªÙŠÙ†'); return; }
  if(new1 !== new2){ alert('ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©'); return; }
  localStorage.setItem(STORAGE_PASS, new1);
  alert('âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
  showScreen('searchScreen');
}

/* ---------------- Search by record ---------------- */
function searchByRecord(){
  const r = document.getElementById('recordSearch').value.trim();
  const target = document.getElementById('recordResult');
  if(!r){ alert('Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„'); return; }
  const found = cars.filter(c => String(c.record || '').includes(r));
  if(found.length === 0){ target.innerHTML = 'ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬'; return; }
  let html = '<table width="100%" border="1" style="border-collapse:collapse"><tr><th>Ø±Ù‚Ù…</th><th>Ø³Ø¬Ù„</th><th>Ù…Ø§Ø±ÙƒØ©</th><th>Ù†ÙˆØ¹</th><th>Ø¹Ø¯Ø§Ø¯</th><th>ØªØ§Ø±ÙŠØ®</th></tr>';
  found.forEach(c => {
    html += `<tr><td>${c.number}</td><td>${c.record}</td><td>${c.brand||''}</td><td>${c.model||''}</td><td>${c.lastOdometer||''}</td><td>${c.lastDate||''}</td></tr>`;
  });
  html += '</table>';
  target.innerHTML = html;
}

/* ---------------- Init ---------------- */
window.onload = function(){
  loadBackup();
  renderCarsList();
  // show login initially
  document.getElementById('loginScreen').classList.remove('hidden');
  document.getElementById('mainApp').classList.add('hidden');
  // don't set main background yet - set after successful login
};
</script>
</body>
</html>
